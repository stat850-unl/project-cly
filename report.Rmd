---
title: |
    | STAT 850 Final Project
    | *** OUR PROJECT TITLE ***
author: 'Yutong Liu, Lin Zhao'
email: 'yutong.liu\@huskers\.unl\.edu, lzhao12\@huskers\.unl\.edu'
abstract: |
    This is our abstract
#bibliography: references.bib
#link-citations: yes
output: 
    pdf_document:
        template: jdf-template.pandoc
        fig_caption: true
        citation_package: biblatex
        keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
library(dplyr)
library(tidyr)
library(ggplot2)
library(tidyverse)
```

```{r load-sas-libraries, echo = F, message = F, warning = F}
library(SASmarkdown)
sas_enginesetup(sashtml=sashtml)
sasexe <- "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe"
sasopts <- "-nosplash -ls 75"
# Linux options (for grading, please leave this in!)
# sasexe <- "/usr/local/SASHome/SASFoundation/9.4/bin/sas_en"
# sasopts <- "-ls 75"
```


# Introduction

Introduction goes here

# Dataset Description

[FoodData](https://fdc.nal.usda.gov/download-datasets.html) is an integrated database that provides food component and nutrient information. There are several tables in the original database, we only take three of them and merge the variables together by **fdc_id**, which is a unique permanent identifier of a food across tables. We would like to discover potential recycling of non-edible food component which has relatively higher nutrient.

Three tables from the database are chosen for this project, one is *food_component.csv*, which contains several different constituent parts of a food like bone, tissues. This table provides information about components, including their weight and whether it is refuse or not. The second table is *food_nutrient.csv*, which provides nutrient value of a food. The third table is *nutrient.csv*. Nutrient is defined as the chemical constituent of a food (e.g. calcium, vitamin E) officially recognized as essential to human health.
Nutrient table contains nutrient names, units and a unique code identifying a nutrient.

By combining three datasets together and selecting several variables, a new dataset called **food_dataset** is generated for further analysis.

Description of variables in *food_dataset*:

*component_name* - The kind of component, e.g. bone

*pct_weight* - The weight of the component as a percentage of the total weight of the food

*is_refuse* - Whether the component is refuse, i.e. not edible

*gram_weight* - The weight of the component in grams
  
*nutrient_name* - Name of the nutrient

*nutrient_amount* - Amount of the nutrient per 100g of food. Specified in unit defined in the nutrient table.

*min* - The minimum amount

*max* - The maximum amount

*median* - The median amount

*nutrient_unit* - The standard unit of measure for the nutrient (per 100g of food)

*nutrition_amount_in_component* - The true value of nutrition amount in component
  
```{r echo = F, message=F, warning=F}
food_component <- read.csv("datasets/food_component.csv")
food_nutrient <- read.csv("datasets/food_nutrient.csv")
nutrient <- read.csv("datasets/nutrient.csv")
food_component_nutrient <- inner_join(food_component,food_nutrient,by = "fdc_id") # This results in 6300 observations of 18 variables
food_component_nutrient <- inner_join(food_component_nutrient, nutrient, by= c("nutrient_id"="id") ) # add the nutrient name instead of nutrient id
food_dataset <- food_component_nutrient[,c(3,4,5,6,11,14,15,16,19,20)] # the "food nutrient of food component" analysis
col_names <- c("component_name","pct_weight","is_refuse","gram_weight","nutrient_amount","min","max","median","nutrient_name","nutrient_unit")
colnames(food_dataset) <- col_names
food_dataset <- food_dataset[,c(1,2,3,4,9,5,6,7,8,10)]
food_dataset <- food_dataset %>% mutate(nutrition_amount_in_component= nutrient_amount/100*(gram_weight/pct_weight))  
```

# Results

## Refuse food component

The variable *is_refuse* in original dataset has two levels: Y (is refuse) and N (not refuse).
Therefore, we can assign all components into 2 groups: one is refuse, another is not refuse. 
Since our ultimate goal is to recycle the refuse components and explore the potential value of them, we plot the data by variable *is_refuse* to see what kind of component is refuse. 

```{r message = F, warning = F, out.width="0.5\\textwidth", out.height="0.5\\textwidth", fig.align="center"}
ggplot(food_dataset)+ geom_bar (aes(x= is_refuse, fill =component_name, weight = nutrition_amount_in_component))
```

The bar chart above shows the detailed information of whether a component is refuse or not. The left bar is not refuse, contains components such as *separable lean*, *total gram weight*, *handling loss*, *edible portion*, *lip lean*. On the right-side bar,the refuse components are mainly *bone and connective tissue*, *connective tissue*, *external fat*, *seam fat*, *bone and cartilage*, *lip fat*, *skin and separable fat*. 

It is easy to see that all of tissues and fats are refuses. Fat, tissue and cartilage are components we can recycle and extract nutrition from. We will only work on refuse components from this point.

## Adjust units of nutrition amount

In order to run statistical analysis on the nutrition amount, it is necessary to have uniform units for all components. First of all, we would like to know how many units exist in dataset and which one is the most commonly used.


```{r message = F, warning = F, out.width="0.5\\textwidth", out.height="0.5\\textwidth", fig.align="center"}
food_dataset <- food_dataset %>% filter(is_refuse == 'Y') %>% group_by (nutrient_name)
ggplot(food_dataset)+ geom_bar(aes(x= component_name, fill =component_name, weight = nutrition_amount_in_component)) + coord_flip() + facet_wrap(~nutrient_unit)
```

We can see from the plot above that most common unit used for nutrition amount in dataset is MG and KJ. We will adjust the mass unit to G, the energy unit to KJ. After adjustment, there exists mass unit *G*, energy unit *KJ* and vitamin unit *IU*. 

Mass unit adjustment: 1 g = 1000 mg = 1000000 ug

Energy unit adjustment: 1 KCAL = 4.184 KJ

```{r message = F, warning=F}
unit<- sub("MG",  "G", food_dataset$nutrient_unit) 
unit<- sub("UG",  "G", unit)
unit<- sub("KCAL",  "kJ", unit)
food_dataset <- food_dataset %>% replace(., "nutrient_unit", c(unit)) %>% unite(., "nutrient_name_nutrient_unit", nutrient_name, nutrient_unit)
```

## Interactive graphics



## Potential recyclable refuse

Vitamins are substances that are needed by human body to grow and develop. Vitamin E an antioxidant, which plays a role in human immune system and metabolic processes. It is a fat-soluble vitamin with several forms, but alpha-tocopherol is the only one used by the human body.  Alpha-tocopherol is also the form that examined in this datset. 

The Recommended Dietary Allowance (RDA) for vitamin E for males and females ages 14 years and older is 15 mg daily, including women who are pregnant. Lactating women need slightly more at 19 mg daily.

The plot below shows the vitamin E content in several refuse components. 

```{r message = F, warning = F, fig.width=12, out.width="0.9\\textwidth", out.height="0.7\\textwidth", fig.align="center"}
vitaminE <- food_dataset %>% filter(str_detect(nutrient_name_nutrient_unit,"Vitamin E")) %>%
  group_by(component_name) %>% 
  summarize(pct_weight = sum(pct_weight),  gram_weight = sum(gram_weight),
            nutrient_amount = sum(nutrient_amount),
            median = sum(median),
            nutrition_amount_in_component = sum(nutrition_amount_in_component))
ggplot(vitaminE) + 
  geom_bar (aes(x= component_name, y = nutrient_amount/gram_weight), stat = "identity") +
  scale_x_discrete(labels = c('Bone and \n cartilage',
                              'Bone and \n connective tissue',
                              'Connective \n tissue',
                              'External \n fat',
                              'Lip fat',
                              'Seam fat',
                              'Skin and \n separable fat')) +
  theme(axis.text=element_text(size=12), axis.title=element_text(size=14,face="bold")) +
  xlab("Component Name") + ylab("Nutrient Amount (G)")
```

We can see that the fats generally contains higher amount of Vitamin E.

```{r, engine="sashtml", engine.path=sasexe, engine.opts=sasopts}
data vitamin;
   input component amount;
   datalines;
bt 0.001768210
bt 0.036890526
bt 0.014144737
fat 0.036195628
fat 0.014054054
fat 0.030688889
fat 0.001758621
;
proc glimmix data = vitamin;
class component;
model amount = component;
run;
```





# Conclusion


# References

Benefits of Vitamin E: [https://medlineplus.gov/vitamine.html](https://medlineplus.gov/vitamine.html)

Recomanded daily Vitamin E amounts: [https://www.hsph.harvard.edu/nutritionsource/vitamin-e/](https://www.hsph.harvard.edu/nutritionsource/vitamin-e/)

